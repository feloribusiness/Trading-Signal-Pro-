<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Signal Pro - Live Trading Signals with TwelveData API</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Live trading signals with real-time TwelveData API for XAUUSD, BTCUSD and Major Forex Pairs. Global market coverage 2025.">
    <meta name="keywords" content="trading signals, forex, crypto, gold, XAUUSD, BTCUSD, TwelveData, real-time, API, 2025">
    <meta name="author" content="Trading Signal Pro">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Trading Signal Pro - Live Trading Signals 2025">
    <meta property="og:description" content="Real-time TwelveData API for XAUUSD, BTCUSD and Major Forex Pairs">
    <meta property="og:type" content="website">
    
    <style>
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        @keyframes fadeOut {
            0% { opacity: 1; transform: scale(1); }
            100% { opacity: 0; transform: scale(0.8); }
        }
        @keyframes slideOut {
            0% { transform: translateX(0); opacity: 1; }
            100% { transform: translateX(100%); opacity: 0; }
        }
        @keyframes slideIn {
            0% { transform: translateY(20px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }
        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }
        @keyframes priceUp {
            0% { background-color: rgba(16, 185, 129, 0.1); }
            100% { background-color: transparent; }
        }
        @keyframes priceDown {
            0% { background-color: rgba(239, 68, 68, 0.1); }
            100% { background-color: transparent; }
        }
        .animate-pulse-slow {
            animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .card-expiring {
            animation: fadeOut 2s ease-out forwards;
        }
        .card-removed {
            animation: slideOut 0.5s ease-out forwards;
        }
        .card-new {
            animation: slideIn 0.5s ease-out;
        }
        .price-up-animation {
            animation: priceUp 1s ease-out;
        }
        .price-down-animation {
            animation: priceDown 1s ease-out;
        }
        .live-indicator {
            position: relative;
            display: inline-block;
        }
        .live-indicator::before {
            content: '';
            position: absolute;
            top: 50%;
            left: -15px;
            transform: translateY(-50%);
            width: 8px;
            height: 8px;
            background: #ef4444;
            border-radius: 50%;
            animation: pulse 1.5s infinite;
        }
        .market-status {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        .market-closed {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        .timezone-badge {
            background: rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }
        .loading-spinner {
            border: 3px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 3px solid #3b82f6;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .signal-card {
            position: relative;
            overflow: hidden;
        }
        .signal-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: shimmer 2s infinite;
        }
        .api-status {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }
        .notification {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 1000;
            max-width: 300px;
        }
        .gold-gradient {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }
        .crypto-gradient {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
        }
        .forex-gradient {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- API Status Indicator -->
    <div class="api-status">
        <div id="apiStatus" class="bg-white rounded-lg shadow-lg p-3 flex items-center space-x-2">
            <div id="apiStatusDot" class="w-3 h-3 bg-gray-500 rounded-full"></div>
            <span id="apiStatusText" class="text-sm">Connecting to TwelveData...</span>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer" class="notification"></div>

    <!-- Header -->
    <header class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-4">
                    <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center">
                        <i class="fas fa-chart-line text-white text-sm"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-gray-900">Trading Signal Pro</h1>
                        <div class="text-xs text-gray-500">XAUUSD, BTCUSD & Major Forex Pairs - TwelveData API</div>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2">
                        <div class="live-indicator text-sm text-gray-600 pl-4">LIVE</div>
                    </div>
                    <div class="text-right">
                        <span class="text-sm text-gray-500" id="currentTime"></span>
                        <div class="text-xs text-gray-400" id="userTimezone"></div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <div class="gradient-bg text-white py-12">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <div class="mb-6">
                <i class="fas fa-chart-candlestick text-6xl mb-4 animate-pulse-slow"></i>
            </div>
            <h2 class="text-4xl font-bold mb-4">Live Trading Signals 2025</h2>
            <p class="text-xl mb-8">Real-time TwelveData API for XAUUSD, BTCUSD & Major Forex Pairs</p>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                <div class="bg-white/10 backdrop-blur rounded-lg p-4">
                    <i class="fas fa-signal text-2xl mb-2"></i>
                    <div class="text-2xl font-bold" id="signalCount">0</div>
                    <div class="text-sm">Active Signals</div>
                </div>
                <div class="bg-white/10 backdrop-blur rounded-lg p-4">
                    <i class="fas fa-percentage text-2xl mb-2"></i>
                    <div class="text-2xl font-bold" id="successRate">0%</div>
                    <div class="text-sm">Success Rate</div>
                </div>
                <div class="bg-white/10 backdrop-blur rounded-lg p-4">
                    <i class="fas fa-clock text-2xl mb-2"></i>
                    <div class="text-2xl font-bold">24/7</div>
                    <div class="text-sm">Live Updates</div>
                </div>
                <div class="bg-white/10 backdrop-blur rounded-lg p-4">
                    <i class="fas fa-globe text-2xl mb-2"></i>
                    <div class="text-2xl font-bold">15</div>
                    <div class="text-sm">Premium Pairs</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Market Status Bar -->
    <div class="market-status text-white py-3">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-4">
                    <span class="font-semibold">Market Sessions:</span>
                    <span class="timezone-badge px-3 py-1 rounded-full text-sm" id="marketSessions">Loading...</span>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="text-sm">Last Update: <span id="lastUpdate">Just now</span></span>
                    <span class="text-sm">Data Source: TwelveData Real-Time API</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Live Chart Section -->
        <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
            <h3 class="text-xl font-bold mb-4 flex items-center">
                <i class="fas fa-chart-area mr-3 text-blue-600"></i>
                Live Market Overview
                <div id="chartLoading" class="ml-3 loading-spinner"></div>
            </h3>
            <div class="h-96">
                <canvas id="marketChart"></canvas>
            </div>
        </div>

        <!-- Quick Stats -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
            <div class="gold-gradient text-white rounded-lg p-4">
                <div class="flex items-center justify-between">
                    <div>
                        <h4 class="font-semibold">XAU/USD</h4>
                        <div class="text-2xl font-bold" id="goldPrice">Loading...</div>
                    </div>
                    <i class="fas fa-coins text-3xl opacity-50"></i>
                </div>
            </div>
            <div class="crypto-gradient text-white rounded-lg p-4">
                <div class="flex items-center justify-between">
                    <div>
                        <h4 class="font-semibold">BTC/USD</h4>
                        <div class="text-2xl font-bold" id="btcPrice">Loading...</div>
                    </div>
                    <i class="fab fa-bitcoin text-3xl opacity-50"></i>
                </div>
            </div>
            <div class="forex-gradient text-white rounded-lg p-4">
                <div class="flex items-center justify-between">
                    <div>
                        <h4 class="font-semibold">EUR/USD</h4>
                        <div class="text-2xl font-bold" id="eurPrice">Loading...</div>
                    </div>
                    <i class="fas fa-dollar-sign text-3xl opacity-50"></i>
                </div>
            </div>
        </div>

        <!-- Performance Report -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
            <div class="bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg p-4">
                <div class="text-3xl font-bold mb-2" id="totalSignals">0</div>
                <div class="text-sm opacity-80">Total Signals</div>
            </div>
            <div class="bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg p-4">
                <div class="text-3xl font-bold mb-2" id="successfulSignals">0</div>
                <div class="text-sm opacity-80">Successful</div>
            </div>
            <div class="bg-gradient-to-r from-yellow-500 to-yellow-600 text-white rounded-lg p-4">
                <div class="text-3xl font-bold mb-2" id="failedSignals">0</div>
                <div class="text-sm opacity-80">Failed</div>
            </div>
            <div class="bg-gradient-to-r from-purple-500 to-purple-600 text-white rounded-lg p-4">
                <div class="text-3xl font-bold mb-2" id="successRateStat">0%</div>
                <div class="text-sm opacity-80">Success Rate</div>
            </div>
        </div>

        <!-- Filter Controls -->
        <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
            <div class="flex flex-wrap gap-4 items-center justify-between">
                <div class="flex flex-wrap gap-2">
                    <select class="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" id="timeframeFilter">
                        <option value="all">All Timeframes</option>
                        <option value="M15">M15 (4 hours validity)</option>
                        <option value="M30">M30 (6 hours validity)</option>
                        <option value="H1">H1 (12 hours validity)</option>
                        <option value="H4">H4 (24 hours validity)</option>
                        <option value="D1">D1 (3 days validity)</option>
                    </select>
                    <select class="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" id="pairFilter">
                        <option value="all">All Pairs</option>
                        <option value="gold">XAU/USD (Gold)</option>
                        <option value="crypto">BTC/USD (Bitcoin)</option>
                        <option value="forex">Major Forex Pairs</option>
                    </select>
                    <select class="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" id="probabilityFilter">
                        <option value="all">All Probabilities</option>
                        <option value="high">High (80%+)</option>
                        <option value="medium">Medium (65-79%)</option>
                        <option value="low">Low (<65%)</option>
                    </select>
                </div>
                <div class="flex gap-2">
                    <button class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg transition-colors" onclick="refreshSignals()">
                        <i class="fas fa-sync-alt mr-2"></i>Refresh
                    </button>
                    <button class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-lg transition-colors" onclick="showReport()">
                        <i class="fas fa-chart-bar mr-2"></i>Report
                    </button>
                </div>
            </div>
        </div>

        <!-- Signals Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6" id="signalsContainer">
            <div class="col-span-full text-center py-12">
                <div class="loading-spinner mx-auto mb-4"></div>
                <p class="text-gray-500">Loading real-time signals from TwelveData API...</p>
            </div>
        </div>

        <!-- Risk Calculator Section -->
        <div class="mt-12 bg-white rounded-lg shadow-sm p-6">
            <h3 class="text-xl font-bold mb-6 flex items-center">
                <i class="fas fa-calculator mr-3 text-blue-600"></i>
                Advanced Risk & Reward Calculator
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Entry Price</label>
                    <input type="number" id="entryPrice" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="1.0856">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Stop Loss</label>
                    <input type="number" id="stopLoss" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="1.0800">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Take Profit</label>
                    <input type="number" id="takeProfit" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="1.0950">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Account Size</label>
                    <input type="number" id="accountSize" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="10000">
                </div>
            </div>
            <div class="mt-6 p-4 bg-gray-50 rounded-lg" id="riskResult" style="display: none;">
                <h4 class="font-semibold mb-2">Calculation Results:</h4>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div>
                        <span class="text-sm text-gray-600">Risk Amount:</span>
                        <div class="font-medium" id="riskAmount">$0</div>
                    </div>
                    <div>
                        <span class="text-sm text-gray-600">Reward Amount:</span>
                        <div class="font-medium" id="rewardAmount">$0</div>
                    </div>
                    <div>
                        <span class="text-sm text-gray-600">Risk/Reward:</span>
                        <div class="font-medium" id="riskReward">1:0</div>
                    </div>
                    <div>
                        <span class="text-sm text-gray-600">Position Size:</span>
                        <div class="font-medium" id="positionSize">0 lots</div>
                    </div>
                </div>
            </div>
            <button class="mt-4 bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg transition-colors" onclick="calculateRiskReward()">
                <i class="fas fa-chart-pie mr-2"></i>Calculate Risk/Reward
            </button>
        </div>
    </div>

    <!-- Performance Report Modal -->
    <div id="reportModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-8 max-w-4xl max-h-[80vh] overflow-y-auto m-4">
            <h2 class="text-3xl font-bold mb-6 text-purple-600">
                <i class="fas fa-chart-bar mr-2"></i>
                Performance Report 2025
            </h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div class="bg-green-50 p-6 rounded-lg">
                    <h3 class="text-xl font-bold mb-4 text-green-800">üìä Success by Probability</h3>
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span>High Probability (80%+):</span>
                            <span class="font-bold" id="highProbSuccess">0%</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Medium Probability (65-79%):</span>
                            <span class="font-bold" id="medProbSuccess">0%</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Low Probability (<65%):</span>
                            <span class="font-bold" id="lowProbSuccess">0%</span>
                        </div>
                    </div>
                </div>
                
                <div class="bg-blue-50 p-6 rounded-lg">
                    <h3 class="text-xl font-bold mb-4 text-blue-800">üìà Signal Statistics</h3>
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span>Total Signals Generated:</span>
                            <span class="font-bold" id="reportTotalSignals">0</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Active Signals:</span>
                            <span class="font-bold" id="reportActiveSignals">0</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Expired Signals:</span>
                            <span class="font-bold" id="reportExpiredSignals">0</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-gray-50 p-6 rounded-lg">
                <h3 class="text-xl font-bold mb-4 text-gray-800">üìù Recent Signal History</h3>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead>
                            <tr class="border-b">
                                <th class="text-left p-2">Time</th>
                                <th class="text-left p-2">Pair</th>
                                <th class="text-left p-2">Type</th>
                                <th class="text-left p-2">Entry</th>
                                <th class="text-left p-2">Probability</th>
                                <th class="text-left p-2">Result</th>
                            </tr>
                        </thead>
                        <tbody id="signalHistory">
                            <!-- Signal history will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="flex justify-between mt-6">
                <button onclick="exportReport()" class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                    <i class="fas fa-download mr-2"></i>Export Report
                </button>
                <button onclick="closeReport()" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                    Close
                </button>
            </div>
        </div>
    </div>

    <script>
        // TwelveData API Configuration
        const API_KEY = 'aec30e04bcb3411883872ee8ac2cb71e';
        const API_BASE_URL = 'https://api.twelvedata.com';
        
        // Global variables
        let currentSignals = [];
        let signalHistory = [];
        let signalStats = {
            total: 0,
            successful: 0,
            failed: 0,
            highProb: { total: 0, successful: 0 },
            medProb: { total: 0, successful: 0 },
            lowProb: { total: 0, successful: 0 }
        };
        let marketChart = null;
        let realTimeData = {};
        let updateInterval = null;

        // FALLBACK DATA if API fails
        const FALLBACK_DATA = {
            'XAUUSD': { price: 2745.67, change: 12.45, change_percent: 0.45 },
            'BTCUSD': { price: 98456.78, change: 1234.56, change_percent: 1.27 },
            'EURUSD': { price: 1.0856, change: 0.0012, change_percent: 0.11 },
            'GBPUSD': { price: 1.2745, change: -0.0008, change_percent: -0.06 },
            'USDJPY': { price: 149.85, change: 0.25, change_percent: 0.17 },
            'USDCHF': { price: 0.8942, change: -0.0005, change_percent: -0.06 },
            'AUDUSD': { price: 0.6648, change: 0.0015, change_percent: 0.23 },
            'USDCAD': { price: 1.3658, change: -0.0012, change_percent: -0.09 },
            'NZDUSD': { price: 0.6152, change: 0.0008, change_percent: 0.13 },
            'EURGBP': { price: 0.8521, change: 0.0009, change_percent: 0.11 },
            'EURJPY': { price: 162.78, change: 0.28, change_percent: 0.17 },
            'GBPJPY': { price: 190.92, change: -0.15, change_percent: -0.08 },
            'EURCHF': { price: 0.9724, change: 0.0007, change_percent: 0.07 }
        };

        // Trading Symbols for TwelveData API
        const PREMIUM_SYMBOLS = {
            gold: ['XAUUSD'],
            crypto: ['BTCUSD'],
            forex: [
                'EURUSD', 'GBPUSD', 'USDJPY', 'USDCHF', 'AUDUSD', 'USDCAD',
                'NZDUSD', 'EURGBP', 'EURJPY', 'GBPJPY', 'EURCHF'
            ]
        };

        // Display names for UI
        const DISPLAY_NAMES = {
            'XAUUSD': 'XAU/USD',
            'BTCUSD': 'BTC/USD',
            'EURUSD': 'EUR/USD',
            'GBPUSD': 'GBP/USD',
            'USDJPY': 'USD/JPY',
            'USDCHF': 'USD/CHF',
            'AUDUSD': 'AUD/USD',
            'USDCAD': 'USD/CAD',
            'NZDUSD': 'NZD/USD',
            'EURGBP': 'EUR/GBP',
            'EURJPY': 'EUR/JPY',
            'GBPJPY': 'GBP/JPY',
            'EURCHF': 'EUR/CHF'
        };

        const timeframes = ['M15', 'M30', 'H1', 'H4', 'D1'];
        const validityHours = {
            'M15': 4, 'M30': 6, 'H1': 12, 'H4': 24, 'D1': 72
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            detectUserTimezone();
            updateCurrentTime();
            setInterval(updateCurrentTime, 1000);
            initializeMarketChart();
            loadRealTimeData();
            startRealTimeUpdates();
        });

        function detectUserTimezone() {
            const now = new Date();
            const offset = -now.getTimezoneOffset() / 60;
            const offsetString = offset >= 0 ? `UTC+${offset}` : `UTC${offset}`;
            
            let timezoneName = offsetString;
            if (offset === 7) timezoneName = 'WIB (Indonesia)';
            else if (offset === 8) timezoneName = 'WITA (Indonesia)';
            else if (offset === 9) timezoneName = 'WIT (Indonesia)';
            else if (offset === 0) timezoneName = 'GMT';
            else if (offset === 1) timezoneName = 'CET';
            else if (offset === 5.5) timezoneName = 'IST';
            else if (offset === 8) timezoneName = 'CST';
            else if (offset === -5) timezoneName = 'EST';
            else if (offset === -8) timezoneName = 'PST';
            
            document.getElementById('userTimezone').textContent = timezoneName;
        }

        function updateCurrentTime() {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric', 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit',
                timeZoneName: 'short'
            };
            
            const localTimeString = now.toLocaleDateString('en-US', options);
            document.getElementById('currentTime').textContent = localTimeString;
            
            // Update market sessions
            updateMarketSessions();
        }

        function updateMarketSessions() {
            const now = new Date();
            const utcHour = now.getUTCHours();
            
            const sessions = [];
            if (utcHour >= 0 && utcHour < 6) sessions.push('Sydney');
            if (utcHour >= 23 || utcHour < 8) sessions.push('Tokyo');
            if (utcHour >= 7 && utcHour < 16) sessions.push('London');
            if (utcHour >= 12 && utcHour < 21) sessions.push('New York');
            
            const sessionText = sessions.length > 0 ? sessions.join(', ') : 'Market Closed';
            document.getElementById('marketSessions').textContent = sessionText;
        }

        function updateAPIStatus(status, message) {
            const dot = document.getElementById('apiStatusDot');
            const text = document.getElementById('apiStatusText');
            
            switch(status) {
                case 'connected':
                    dot.className = 'w-3 h-3 bg-green-500 rounded-full';
                    text.textContent = 'Connected to TwelveData';
                    break;
                case 'error':
                    dot.className = 'w-3 h-3 bg-red-500 rounded-full';
                    text.textContent = 'Using Fallback Data';
                    break;
                case 'loading':
                    dot.className = 'w-3 h-3 bg-yellow-500 rounded-full animate-pulse';
                    text.textContent = 'Loading data...';
                    break;
                default:
                    dot.className = 'w-3 h-3 bg-gray-500 rounded-full';
                    text.textContent = message;
            }
        }

        function showNotification(message, type = 'success') {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            const bgColor = type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : 'bg-blue-500';
            
            notification.className = `${bgColor} text-white px-6 py-3 rounded-lg shadow-lg mb-2 animate-pulse-slow`;
            notification.textContent = message;
            container.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        async function fetchRealTimeData(symbols) {
            try {
                updateAPIStatus('loading', 'Fetching real-time data...');
                
                const promises = symbols.map(async (symbol) => {
                    try {
                        const response = await fetch(`${API_BASE_URL}/quote?symbol=${symbol}&apikey=${API_KEY}`);
                        if (!response.ok) throw new Error(`Failed to fetch ${symbol}`);
                        const data = await response.json();
                        return {
                            symbol: data.symbol,
                            price: parseFloat(data.price),
                            change: parseFloat(data.change),
                            change_percent: parseFloat(data.change_percent),
                            timestamp: data.timestamp
                        };
                    } catch (error) {
                        console.warn(`API failed for ${symbol}, using fallback data`);
                        // Use fallback data if API fails
                        const fallback = FALLBACK_DATA[symbol];
                        if (fallback) {
                            return {
                                symbol: symbol,
                                price: fallback.price + (Math.random() - 0.5) * fallback.price * 0.001, // Small random variation
                                change: fallback.change + (Math.random() - 0.5) * 0.1,
                                change_percent: fallback.change_percent + (Math.random() - 0.5) * 0.05,
                                timestamp: new Date().toISOString()
                            };
                        }
                        return null;
                    }
                });
                
                const results = await Promise.all(promises);
                const validResults = results.filter(result => result !== null);
                
                if (validResults.length > 0) {
                    updateAPIStatus('connected');
                } else {
                    updateAPIStatus('error', 'Using Fallback Data');
                }
                
                return validResults;
            } catch (error) {
                console.error('Error fetching real-time data:', error);
                updateAPIStatus('error', 'Using Fallback Data');
                showNotification('Using fallback data - API may be limited', 'error');
                
                // Return fallback data if everything fails
                return Object.keys(FALLBACK_DATA).map(symbol => ({
                    symbol: symbol,
                    price: FALLBACK_DATA[symbol].price + (Math.random() - 0.5) * FALLBACK_DATA[symbol].price * 0.001,
                    change: FALLBACK_DATA[symbol].change + (Math.random() - 0.5) * 0.1,
                    change_percent: FALLBACK_DATA[symbol].change_percent + (Math.random() - 0.5) * 0.05,
                    timestamp: new Date().toISOString()
                }));
            }
        }

        async function loadRealTimeData() {
            const allSymbols = [
                ...PREMIUM_SYMBOLS.gold,
                ...PREMIUM_SYMBOLS.crypto,
                ...PREMIUM_SYMBOLS.forex
            ];
            
            const data = await fetchRealTimeData(allSymbols);
            
            if (data.length > 0) {
                realTimeData = {};
                data.forEach(item => {
                    if (item && item.symbol && !isNaN(item.price)) {
                        realTimeData[item.symbol] = item;
                    }
                });
                
                // Update quick stats
                updateQuickStats();
                
                generateSignalsFromRealData();
                updateChart();
                document.getElementById('chartLoading').style.display = 'none';
            }
        }

        function updateQuickStats() {
            // Update Gold price
            if (realTimeData['XAUUSD'] && !isNaN(realTimeData['XAUUSD'].price)) {
                const goldData = realTimeData['XAUUSD'];
                document.getElementById('goldPrice').innerHTML = 
                    `$${goldData.price.toFixed(2)} <span class="text-sm ${goldData.change_percent >= 0 ? 'text-green-200' : 'text-red-200'}">(${goldData.change_percent >= 0 ? '+' : ''}${goldData.change_percent.toFixed(2)}%)</span>`;
            }
            
            // Update BTC price
            if (realTimeData['BTCUSD'] && !isNaN(realTimeData['BTCUSD'].price)) {
                const btcData = realTimeData['BTCUSD'];
                document.getElementById('btcPrice').innerHTML = 
                    `$${btcData.price.toFixed(2)} <span class="text-sm ${btcData.change_percent >= 0 ? 'text-green-200' : 'text-red-200'}">(${btcData.change_percent >= 0 ? '+' : ''}${btcData.change_percent.toFixed(2)}%)</span>`;
            }
            
            // Update EUR/USD price
            if (realTimeData['EURUSD'] && !isNaN(realTimeData['EURUSD'].price)) {
                const eurData = realTimeData['EURUSD'];
                document.getElementById('eurPrice').innerHTML = 
                    `${eurData.price.toFixed(5)} <span class="text-sm ${eurData.change_percent >= 0 ? 'text-green-200' : 'text-red-200'}">(${eurData.change_percent >= 0 ? '+' : ''}${eurData.change_percent.toFixed(2)}%)</span>`;
            }
        }

        function generateSignalsFromRealData() {
            currentSignals = [];
            const signalCount = 10;
            
            const symbols = Object.keys(realTimeData);
            for (let i = 0; i < Math.min(signalCount, symbols.length); i++) {
                const symbol = symbols[i];
                const data = realTimeData[symbol];
                
                // Skip if data is invalid
                if (!data || !symbol || isNaN(data.price) || isNaN(data.change_percent)) {
                    continue;
                }
                
                const category = getCategoryFromSymbol(symbol);
                const timeframe = timeframes[Math.floor(Math.random() * timeframes.length)];
                const type = generateSignalType(data.change_percent);
                const probability = generateProbability(data.change_percent, type);
                
                const signal = {
                    id: Date.now() + i,
                    symbol: symbol,
                    displayName: DISPLAY_NAMES[symbol] || symbol,
                    type,
                    entry: data.price,
                    sl: calculateStopLoss(data.price, type, symbol),
                    tp: calculateTakeProfit(data.price, type, symbol),
                    timeframe,
                    probability: probability.value,
                    probLevel: probability.level,
                    category,
                    createdAt: new Date(),
                    validHours: validityHours[timeframe],
                    status: 'active',
                    currentPrice: data.price,
                    priceChange: data.change_percent,
                    volume: Math.floor(Math.random() * 100000) + 10000
                };
                
                currentSignals.push(signal);
                signalStats.total++;
                
                // Update probability stats
                if (signal.probLevel === 'high') signalStats.highProb.total++;
                else if (signal.probLevel === 'medium') signalStats.medProb.total++;
                else signalStats.lowProb.total++;
            }
            
            filterSignals();
            updateStats();
            showNotification('Generated signals from real-time data');
        }

        function getCategoryFromSymbol(symbol) {
            if (symbol === 'XAUUSD') return 'gold';
            if (symbol === 'BTCUSD') return 'crypto';
            return 'forex';
        }

        function generateSignalType(changePercent) {
            const absChange = Math.abs(changePercent);
            if (absChange > 2) {
                return changePercent > 0 ? 'BUY' : 'SELL';
            } else if (absChange > 1) {
                return Math.random() > 0.6 ? (changePercent > 0 ? 'BUY' : 'SELL') : (Math.random() > 0.5 ? 'BUY' : 'SELL');
            } else {
                return Math.random() > 0.5 ? 'BUY' : 'SELL';
            }
        }

        function generateProbability(changePercent, type) {
            const absChange = Math.abs(changePercent);
            let baseProbability = 50;
            
            // Adjust probability based on price movement
            if (absChange > 3) baseProbability += 25;
            else if (absChange > 2) baseProbability += 15;
            else if (absChange > 1) baseProbability += 10;
            else if (absChange > 0.5) baseProbability += 5;
            
            // Adjust based on signal type and price direction
            if ((type === 'BUY' && changePercent > 0) || (type === 'SELL' && changePercent < 0)) {
                baseProbability += 10;
            } else {
                baseProbability -= 5;
            }
            
            // Add some randomness
            baseProbability += Math.random() * 20 - 10;
            baseProbability = Math.max(30, Math.min(95, baseProbability));
            
            const probValue = Math.floor(baseProbability);
            let probLevel;
            if (probValue >= 80) probLevel = 'high';
            else if (probValue >= 65) probLevel = 'medium';
            else probLevel = 'low';
            
            return { value: probValue, level: probLevel };
        }

        function calculateStopLoss(price, type, symbol) {
            let stopLossPercent;
            
            // Different stop loss percentages for different instruments
            if (symbol === 'XAUUSD') {
                stopLossPercent = 0.008 + Math.random() * 0.012; // 0.8-2%
            } else if (symbol === 'BTCUSD') {
                stopLossPercent = 0.02 + Math.random() * 0.03; // 2-5%
            } else {
                stopLossPercent = 0.008 + Math.random() * 0.012; // 0.8-2%
            }
            
            return type === 'BUY' ? price * (1 - stopLossPercent) : price * (1 + stopLossPercent);
        }

        function calculateTakeProfit(price, type, symbol) {
            let takeProfitPercent;
            
            // Different take profit percentages for different instruments
            if (symbol === 'XAUUSD') {
                takeProfitPercent = 0.015 + Math.random() * 0.025; // 1.5-4%
            } else if (symbol === 'BTCUSD') {
                takeProfitPercent = 0.04 + Math.random() * 0.06; // 4-10%
            } else {
                takeProfitPercent = 0.015 + Math.random() * 0.025; // 1.5-4%
            }
            
            return type === 'BUY' ? price * (1 + takeProfitPercent) : price * (1 - takeProfitPercent);
        }

        function initializeMarketChart() {
            const ctx = document.getElementById('marketChart').getContext('2d');
            
            marketChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Market Activity',
                        data: [],
                        borderColor: 'rgb(75, 192, 192)',
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false
                        }
                    }
                }
            });
        }

        function updateChart() {
            if (!marketChart) return;
            
            const symbols = Object.keys(realTimeData);
            const labels = symbols.map(symbol => DISPLAY_NAMES[symbol] || symbol);
            const data = symbols.map(symbol => {
                const item = realTimeData[symbol];
                return item && !isNaN(item.change_percent) ? item.change_percent : 0;
            });
            
            marketChart.data.labels = labels;
            marketChart.data.datasets[0].data = data;
            marketChart.update();
        }

        function startRealTimeUpdates() {
            // Update data every 30 seconds
            updateInterval = setInterval(() => {
                loadRealTimeData();
                document.getElementById('lastUpdate').textContent = 'Just now';
            }, 30000);
            
            // Update last update time every minute
            setInterval(() => {
                const lastUpdate = document.getElementById('lastUpdate');
                if (lastUpdate.textContent === 'Just now') {
                    setTimeout(() => {
                        lastUpdate.textContent = '1 min ago';
                    }, 60000);
                }
            }, 60000);
        }

        function createSignalCard(signal) {
            const now = new Date();
            const createdTime = new Date(signal.createdAt);
            const elapsedHours = (now - createdTime) / (1000 * 60 * 60);
            const remainingHours = Math.max(0, signal.validHours - elapsedHours);
            const isExpiring = remainingHours < 1 && remainingHours > 0;
            const isExpired = remainingHours <= 0;
            
            const typeColor = signal.type === 'BUY' ? 'green' : 'red';
            const probColor = signal.probLevel === 'high' ? 'green' : signal.probLevel === 'medium' ? 'yellow' : 'red';
            const priceColor = signal.priceChange > 0 ? 'green' : 'red';
            
            const decimals = signal.symbol.includes('JPY') ? 2 : 
                            signal.symbol === 'BTCUSD' ? 2 : 
                            signal.symbol === 'XAUUSD' ? 2 : 4;
            
            const categoryIcon = signal.category === 'gold' ? 'fa-coins' : 
                                signal.category === 'crypto' ? 'fab fa-bitcoin' : 
                                'fa-dollar-sign';
            
            const categoryColor = signal.category === 'gold' ? 'text-yellow-600' : 
                                 signal.category === 'crypto' ? 'text-purple-600' : 
                                 'text-blue-600';
            
            // Validate all numeric values
            const entry = !isNaN(signal.entry) ? signal.entry.toFixed(decimals) : '0.0000';
            const sl = !isNaN(signal.sl) ? signal.sl.toFixed(decimals) : '0.0000';
            const tp = !isNaN(signal.tp) ? signal.tp.toFixed(decimals) : '0.0000';
            const currentPrice = !isNaN(signal.currentPrice) ? signal.currentPrice.toFixed(decimals) : '0.0000';
            const priceChange = !isNaN(signal.priceChange) ? signal.priceChange.toFixed(2) : '0.00';
            
            return `
                <div class="signal-card bg-white rounded-lg shadow-md p-6 card-hover ${isExpiring ? 'card-expiring' : ''} ${isExpired ? 'opacity-50' : ''}" data-signal-id="${signal.id}">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h3 class="text-lg font-bold text-gray-900">${signal.displayName}</h3>
                            <p class="text-sm text-gray-500 flex items-center">
                                <i class="fas ${categoryIcon} ${categoryColor} mr-1"></i>
                                ${signal.timeframe} ‚Ä¢ ${signal.category.toUpperCase()}
                            </p>
                        </div>
                        <div class="text-right">
                            <span class="inline-block px-3 py-1 text-xs font-semibold text-white bg-${typeColor}-500 rounded-full">
                                ${signal.type}
                            </span>
                            <div class="mt-1">
                                <span class="inline-block px-2 py-1 text-xs font-semibold text-white bg-${probColor}-500 rounded">
                                    ${signal.probability}%
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="space-y-2 mb-4">
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600">Entry:</span>
                            <span class="font-mono font-semibold">${entry}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600">SL:</span>
                            <span class="font-mono text-red-600 font-semibold">${sl}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600">TP:</span>
                            <span class="font-mono text-green-600 font-semibold">${tp}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600">Current:</span>
                            <span class="font-mono text-${priceColor}-600 font-semibold">
                                ${currentPrice}
                                <span class="text-xs ml-1">(${priceChange > 0 ? '+' : ''}${priceChange}%)</span>
                            </span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600">Volume:</span>
                            <span class="font-mono text-gray-600">${signal.volume.toLocaleString()}</span>
                        </div>
                    </div>
                    
                    <div class="border-t pt-3">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-xs text-gray-500">Created: ${createdTime.toLocaleTimeString()}</span>
                            <span class="text-xs text-gray-500">Valid for ${signal.validHours}h</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-xs font-semibold ${isExpiring ? 'text-red-600 animate-pulse' : 'text-gray-600'}">
                                ${isExpired ? 'EXPIRED' : isExpiring ? 'EXPIRING SOON' : 'Time Left'}
                            </span>
                            <span class="text-xs font-bold ${isExpiring ? 'text-red-600' : 'text-gray-700'}">
                                ${isExpired ? '0h 0m' : formatTimeRemaining(remainingHours)}
                            </span>
                        </div>
                    </div>
                </div>
            `;
        }

        function formatTimeRemaining(hours) {
            const h = Math.floor(hours);
            const m = Math.floor((hours - h) * 60);
            return `${h}h ${m}m`;
        }

        function filterSignals() {
            const timeframeFilter = document.getElementById('timeframeFilter').value;
            const pairFilter = document.getElementById('pairFilter').value;
            const probabilityFilter = document.getElementById('probabilityFilter').value;
            
            let filtered = currentSignals.filter(signal => {
                if (signal.status === 'expired') return false;
                
                if (timeframeFilter !== 'all' && signal.timeframe !== timeframeFilter) return false;
                if (pairFilter !== 'all' && signal.category !== pairFilter) return false;
                if (probabilityFilter !== 'all') {
                    if (probabilityFilter === 'high' && signal.probLevel !== 'high') return false;
                    if (probabilityFilter === 'medium' && signal.probLevel !== 'medium') return false;
                    if (probabilityFilter === 'low' && signal.probLevel !== 'low') return false;
                }
                
                return true;
            });
            
            const container = document.getElementById('signalsContainer');
            container.innerHTML = filtered.map(signal => createSignalCard(signal)).join('');
            document.getElementById('signalCount').textContent = filtered.length;
        }

        function refreshSignals() {
            loadRealTimeData();
            showNotification('Refreshing signals with latest data');
        }

        function calculateRiskReward() {
            const entry = parseFloat(document.getElementById('entryPrice').value);
            const sl = parseFloat(document.getElementById('stopLoss').value);
            const tp = parseFloat(document.getElementById('takeProfit').value);
            const accountSize = parseFloat(document.getElementById('accountSize').value) || 10000;
            
            if (!entry || !sl || !tp) {
                alert('Please fill in all price fields');
                return;
            }
            
            const riskPips = Math.abs(entry - sl);
            const rewardPips = Math.abs(tp - entry);
            const riskRewardRatio = rewardPips / riskPips;
            
            const riskAmount = accountSize * 0.01;
            const rewardAmount = riskAmount * riskRewardRatio;
            const positionSize = (riskAmount / riskPips) * 10000;
            
            document.getElementById('riskAmount').textContent = `$${riskAmount.toFixed(2)}`;
            document.getElementById('rewardAmount').textContent = `$${rewardAmount.toFixed(2)}`;
            document.getElementById('riskReward').textContent = `1:${riskRewardRatio.toFixed(2)}`;
            document.getElementById('positionSize').textContent = `${positionSize.toFixed(2)} lots`;
            document.getElementById('riskResult').style.display = 'block';
        }

        function updateStats() {
            const activeSignals = currentSignals.filter(s => s.status === 'active').length;
            const successRate = signalStats.total > 0 ? ((signalStats.successful / signalStats.total) * 100).toFixed(1) : 0;
            
            document.getElementById('totalSignals').textContent = signalStats.total;
            document.getElementById('successfulSignals').textContent = signalStats.successful;
            document.getElementById('failedSignals').textContent = signalStats.failed;
            document.getElementById('successRateStat').textContent = `${successRate}%`;
            document.getElementById('successRate').textContent = `${successRate}%`;
        }

        function showReport() {
            const modal = document.getElementById('reportModal');
            modal.style.display = 'flex';
            
            // Update report data
            const activeSignals = currentSignals.filter(s => s.status === 'active').length;
            const expiredSignals = currentSignals.filter(s => s.status === 'expired').length;
            
            document.getElementById('reportTotalSignals').textContent = signalStats.total;
            document.getElementById('reportActiveSignals').textContent = activeSignals;
            document.getElementById('reportExpiredSignals').textContent = expiredSignals;
            
            // Calculate success rates by probability
            const highProbSuccess = signalStats.highProb.total > 0 ? 
                ((signalStats.highProb.successful / signalStats.highProb.total) * 100).toFixed(1) : 0;
            const medProbSuccess = signalStats.medProb.total > 0 ? 
                ((signalStats.medProb.successful / signalStats.medProb.total) * 100).toFixed(1) : 0;
            const lowProbSuccess = signalStats.lowProb.total > 0 ? 
                ((signalStats.lowProb.successful / signalStats.lowProb.total) * 100).toFixed(1) : 0;
            
            document.getElementById('highProbSuccess').textContent = `${highProbSuccess}%`;
            document.getElementById('medProbSuccess').textContent = `${medProbSuccess}%`;
            document.getElementById('lowProbSuccess').textContent = `${lowProbSuccess}%`;
            
            // Update signal history table
            const historyTable = document.getElementById('signalHistory');
            const recentHistory = signalHistory.slice(-10).reverse();
            
            historyTable.innerHTML = recentHistory.map(signal => `
                <tr class="border-b">
                    <td class="p-2">${new Date(signal.completedAt).toLocaleString()}</td>
                    <td class="p-2">${signal.displayName || signal.symbol}</td>
                    <td class="p-2">
                        <span class="px-2 py-1 text-xs font-semibold text-white bg-${signal.type === 'BUY' ? 'green' : 'red'}-500 rounded">
                            ${signal.type}
                        </span>
                    </td>
                    <td class="p-2">${signal.entry}</td>
                    <td class="p-2">${signal.probability}%</td>
                    <td class="p-2">
                        <span class="px-2 py-1 text-xs font-semibold text-white bg-${signal.result === 'Success' ? 'green' : 'red'}-500 rounded">
                            ${signal.result}
                        </span>
                    </td>
                </tr>
            `).join('');
        }

        function closeReport() {
            document.getElementById('reportModal').style.display = 'none';
        }

        function exportReport() {
            const reportData = {
                generatedAt: new Date().toISOString(),
                statistics: signalStats,
                signalHistory: signalHistory,
                currentSignals: currentSignals
            };
            
            const dataStr = JSON.stringify(reportData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `trading-report-${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showNotification('Report exported successfully');
        }

        // Event listeners
        document.getElementById('timeframeFilter').addEventListener('change', filterSignals);
        document.getElementById('pairFilter').addEventListener('change', filterSignals);
        document.getElementById('probabilityFilter').addEventListener('change', filterSignals);

        // Clean up on page unload
        window.addEventListener('beforeunload', () => {
            if (updateInterval) {
                clearInterval(updateInterval);
            }
        });
    </script>
</body>
</html>
